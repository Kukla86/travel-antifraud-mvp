<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Antifraud Test</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        h1 { 
            text-align: center; 
            color: #60a5fa; 
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }
        
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        
        .test-card { 
            background: rgba(30, 41, 59, 0.8); 
            border: 1px solid rgba(96, 165, 250, 0.2); 
            border-radius: 12px; 
            padding: 20px; 
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .test-card h3 { 
            color: #60a5fa; 
            margin-top: 0; 
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
            padding-bottom: 10px;
        }
        
        .form-group { margin: 15px 0; }
        
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            color: #cbd5e1; 
            font-weight: 500;
        }
        
        .form-group input, .form-group select { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid rgba(96, 165, 250, 0.3); 
            border-radius: 8px; 
            background: rgba(15, 23, 42, 0.8); 
            color: #e2e8f0; 
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        .test-button { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
            color: white; 
            padding: 12px 24px; 
            margin: 10px 5px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .test-button:hover { 
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .result { 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .high-risk { 
            background: linear-gradient(135deg, #dc2626, #991b1b); 
            border: 1px solid #fca5a5;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
        }
        
        .medium-risk { 
            background: linear-gradient(135deg, #f59e0b, #d97706); 
            border: 1px solid #fbbf24;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        
        .low-risk { 
            background: linear-gradient(135deg, #059669, #047857); 
            border: 1px solid #34d399;
            box-shadow: 0 0 20px rgba(5, 150, 105, 0.3);
        }
        
        .ml-details {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .ml-section {
            margin: 10px 0;
            padding: 10px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
        }
        
        .ml-section h4 {
            color: #60a5fa;
            margin: 0 0 8px 0;
            font-size: 14px;
        }
        
        .anomaly-item {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        .behavioral-item {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .score-item {
            background: rgba(30, 41, 59, 0.8);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        
        .score-value {
            font-size: 18px;
            font-weight: bold;
            color: #60a5fa;
        }
        
        .score-label {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ ML Antifraud Test Suite</h1>
        
        <div class="test-grid">
            <!-- Bot Test -->
            <div class="test-card">
                <h3>ü§ñ Bot Detection Test</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="bot-email" value="bot@example.com">
                </div>
                <div class="form-group">
                    <label>User Agent:</label>
                    <input type="text" id="bot-ua" value="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)">
                </div>
                <div class="form-group">
                    <label>Typing Speed (chars/min):</label>
                    <input type="number" id="bot-typing" value="500">
                </div>
                <div class="form-group">
                    <label>Mouse Movements:</label>
                    <input type="number" id="bot-mouse" value="2">
                </div>
                <div class="form-group">
                    <label>First Click (seconds):</label>
                    <input type="number" id="bot-click" value="0.1" step="0.1">
                </div>
                <button class="test-button" onclick="testBot()">Test Bot Detection</button>
                <div id="bot-result" class="result"></div>
            </div>

            <!-- Human Test -->
            <div class="test-card">
                <h3>üë§ Human Behavior Test</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="human-email" value="john.doe@gmail.com">
                </div>
                <div class="form-group">
                    <label>User Agent:</label>
                    <input type="text" id="human-ua" value="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36">
                </div>
                <div class="form-group">
                    <label>Typing Speed (chars/min):</label>
                    <input type="number" id="human-typing" value="120">
                </div>
                <div class="form-group">
                    <label>Mouse Movements:</label>
                    <input type="number" id="human-mouse" value="45">
                </div>
                <div class="form-group">
                    <label>First Click (seconds):</label>
                    <input type="number" id="human-click" value="3.2" step="0.1">
                </div>
                <button class="test-button" onclick="testHuman()">Test Human Behavior</button>
                <div id="human-result" class="result"></div>
            </div>

            <!-- Suspicious Test -->
            <div class="test-card">
                <h3>‚ö†Ô∏è Suspicious Activity Test</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="susp-email" value="test123456@tempmail.com">
                </div>
                <div class="form-group">
                    <label>User Agent:</label>
                    <input type="text" id="susp-ua" value="python-requests/2.28.1">
                </div>
                <div class="form-group">
                    <label>Typing Speed (chars/min):</label>
                    <input type="number" id="susp-typing" value="350">
                </div>
                <div class="form-group">
                    <label>Mouse Movements:</label>
                    <input type="number" id="susp-mouse" value="1">
                </div>
                <div class="form-group">
                    <label>First Click (seconds):</label>
                    <input type="number" id="susp-click" value="0.05" step="0.01">
                </div>
                <button class="test-button" onclick="testSuspicious()">Test Suspicious Activity</button>
                <div id="susp-result" class="result"></div>
            </div>

            <!-- Custom Test -->
            <div class="test-card">
                <h3>üéØ Custom Test</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="custom-email" placeholder="Enter email">
                </div>
                <div class="form-group">
                    <label>BIN:</label>
                    <input type="text" id="custom-bin" placeholder="411111" maxlength="6">
                </div>
                <div class="form-group">
                    <label>IP:</label>
                    <input type="text" id="custom-ip" placeholder="8.8.8.8">
                </div>
                <div class="form-group">
                    <label>User Agent:</label>
                    <input type="text" id="custom-ua" placeholder="Mozilla/5.0...">
                </div>
                <div class="form-group">
                    <label>Typing Speed (chars/min):</label>
                    <input type="number" id="custom-typing" placeholder="100">
                </div>
                <div class="form-group">
                    <label>Mouse Movements:</label>
                    <input type="number" id="custom-mouse" placeholder="20">
                </div>
                <div class="form-group">
                    <label>First Click (seconds):</label>
                    <input type="number" id="custom-click" placeholder="2.0" step="0.1">
                </div>
                <button class="test-button" onclick="testCustom()">Test Custom Scenario</button>
                <div id="custom-result" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const API_KEY = 'antifraud_dev_key_2024';

        async function makeRequest(data) {
            try {
                const response = await fetch(`${API_BASE}/api/check`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                return { error: error.message };
            }
        }

        function displayResult(elementId, result, title) {
            const element = document.getElementById(elementId);
            if (result.error) {
                element.innerHTML = `<strong>${title}:</strong> Error: ${result.error}`;
                element.className = 'result high-risk';
                return;
            }

            const riskClass = result.risk_score > 70 ? 'high-risk' : 
                             result.risk_score > 30 ? 'medium-risk' : 'low-risk';

            let html = `<strong>${title}:</strong><br>`;
            html += `Risk Score: <strong>${result.risk_score}</strong><br>`;
            html += `Recommendation: <strong>${result.recommendation.toUpperCase()}</strong><br>`;
            html += `Flags: ${result.fraud_flags ? result.fraud_flags.join(', ') : 'None'}<br>`;

            if (result.ml_analysis) {
                html += `<div class="ml-details">`;
                html += `<h4>üß† ML Analysis</h4>`;
                
                // Score breakdown
                html += `<div class="score-breakdown">`;
                html += `<div class="score-item"><div class="score-value">${result.ml_analysis.base_score}</div><div class="score-label">Base Score</div></div>`;
                html += `<div class="score-item"><div class="score-value">${result.ml_analysis.ml_anomaly_score}</div><div class="score-label">ML Anomaly</div></div>`;
                html += `<div class="score-item"><div class="score-value">${result.ml_analysis.behavioral_score}</div><div class="score-label">Behavioral</div></div>`;
                html += `<div class="score-item"><div class="score-value">${result.ml_analysis.total_score}</div><div class="score-label">Total</div></div>`;
                html += `</div>`;

                // Anomalies
                if (result.ml_analysis.anomalies && result.ml_analysis.anomalies.length > 0) {
                    html += `<div class="ml-section">`;
                    html += `<h4>üö® Detected Anomalies</h4>`;
                    result.ml_analysis.anomalies.forEach(anomaly => {
                        html += `<div class="anomaly-item">`;
                        html += `<strong>${anomaly.feature}</strong>: ${anomaly.type} (score: ${anomaly.score.toFixed(2)})`;
                        html += `</div>`;
                    });
                    html += `</div>`;
                }

                // Behavioral analysis
                if (result.ml_analysis.behavioral_analysis) {
                    const behavior = result.ml_analysis.behavioral_analysis;
                    html += `<div class="ml-section">`;
                    html += `<h4>üë§ Behavioral Analysis</h4>`;
                    html += `<div class="behavioral-item">Human-like Score: ${behavior.human_like_score || 0}/100</div>`;
                    if (behavior.bot_indicators && behavior.bot_indicators.length > 0) {
                        html += `<div class="behavioral-item">Bot Indicators: ${behavior.bot_indicators.join(', ')}</div>`;
                    }
                    if (behavior.suspicious_patterns && behavior.suspicious_patterns.length > 0) {
                        html += `<div class="behavioral-item">Suspicious Patterns: ${behavior.suspicious_patterns.join(', ')}</div>`;
                    }
                    if (behavior.risk_factors && behavior.risk_factors.length > 0) {
                        html += `<div class="behavioral-item">Risk Factors: ${behavior.risk_factors.join(', ')}</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div>`;
            }

            element.innerHTML = html;
            element.className = `result ${riskClass}`;
        }

        async function testBot() {
            const data = {
                email: document.getElementById('bot-email').value,
                bin: '411111',
                ip: '8.8.8.8',
                userAgent: document.getElementById('bot-ua').value,
                deviceInfo: {
                    platform: navigator.platform,
                    screen: { width: screen.width, height: screen.height },
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                session_duration_ms: 5000,
                typing_speed_ms_avg: parseInt(document.getElementById('bot-typing').value),
                mouse_moves_count: parseInt(document.getElementById('bot-mouse').value),
                first_click_delay_ms: parseFloat(document.getElementById('bot-click').value) * 1000
            };
            
            const result = await makeRequest(data);
            displayResult('bot-result', result, 'Bot Detection Test');
        }

        async function testHuman() {
            const data = {
                email: document.getElementById('human-email').value,
                bin: '555555',
                ip: '1.1.1.1',
                userAgent: document.getElementById('human-ua').value,
                deviceInfo: {
                    platform: navigator.platform,
                    screen: { width: screen.width, height: screen.height },
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                session_duration_ms: 120000,
                typing_speed_ms_avg: parseInt(document.getElementById('human-typing').value),
                mouse_moves_count: parseInt(document.getElementById('human-mouse').value),
                first_click_delay_ms: parseFloat(document.getElementById('human-click').value) * 1000
            };
            
            const result = await makeRequest(data);
            displayResult('human-result', result, 'Human Behavior Test');
        }

        async function testSuspicious() {
            const data = {
                email: document.getElementById('susp-email').value,
                bin: '123456',
                ip: '192.168.1.1',
                userAgent: document.getElementById('susp-ua').value,
                deviceInfo: {
                    platform: 'Linux',
                    screen: { width: 0, height: 0 },
                    language: 'en',
                    timezone: 'UTC'
                },
                session_duration_ms: 1000,
                typing_speed_ms_avg: parseInt(document.getElementById('susp-typing').value),
                mouse_moves_count: parseInt(document.getElementById('susp-mouse').value),
                first_click_delay_ms: parseFloat(document.getElementById('susp-click').value) * 1000
            };
            
            const result = await makeRequest(data);
            displayResult('susp-result', result, 'Suspicious Activity Test');
        }

        async function testCustom() {
            const data = {
                email: document.getElementById('custom-email').value || 'test@example.com',
                bin: document.getElementById('custom-bin').value || '411111',
                ip: document.getElementById('custom-ip').value || '8.8.8.8',
                userAgent: document.getElementById('custom-ua').value || navigator.userAgent,
                deviceInfo: {
                    platform: navigator.platform,
                    screen: { width: screen.width, height: screen.height },
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                session_duration_ms: 60000,
                typing_speed_ms_avg: parseInt(document.getElementById('custom-typing').value) || 100,
                mouse_moves_count: parseInt(document.getElementById('custom-mouse').value) || 20,
                first_click_delay_ms: (parseFloat(document.getElementById('custom-click').value) || 2.0) * 1000
            };
            
            const result = await makeRequest(data);
            displayResult('custom-result', result, 'Custom Test');
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('custom-email').value = 'test@example.com';
        document.getElementById('custom-bin').value = '411111';
        document.getElementById('custom-ip').value = '8.8.8.8';
        document.getElementById('custom-ua').value = navigator.userAgent;
        document.getElementById('custom-typing').value = '100';
        document.getElementById('custom-mouse').value = '20';
        document.getElementById('custom-click').value = '2.0';
    </script>
</body>
</html>
